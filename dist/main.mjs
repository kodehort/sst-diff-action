import{h as F,i as pe,z as V}from"./chunk-PT6L7NJD.mjs";import{Za as me,a as Ye,b as Qe,bd as ge}from"./chunk-7H2TFXPN.mjs";import"./chunk-IQOVF5LO.mjs";import"./chunk-5PARVRO5.mjs";import"./chunk-3PEVV4HI.mjs";import"./chunk-R6PYGTER.mjs";import"./chunk-SUBS3TDM.mjs";import"./chunk-KU6QELUJ.mjs";import"./chunk-ISPMX3VH.mjs";import"./chunk-THC7OU5T.mjs";import{a as g,c as O,e as he,f as ze}from"./chunk-7S7IXY6P.mjs";var G=O(C=>{"use strict";Object.defineProperty(C,"__esModule",{value:!0});C.toCommandProperties=C.toCommandValue=void 0;function Xe(e){return e==null?"":typeof e=="string"||e instanceof String?e:JSON.stringify(e)}C.toCommandValue=Xe;function Ze(e){return Object.keys(e).length?{title:e.title,file:e.file,line:e.startLine,endLine:e.endLine,col:e.startColumn,endColumn:e.endColumn}:{}}C.toCommandProperties=Ze});var ye=O(b=>{"use strict";var et=b&&b.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),tt=b&&b.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),rt=b&&b.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&et(t,e,r);return tt(t,e),t};Object.defineProperty(b,"__esModule",{value:!0});b.issue=b.issueCommand=void 0;var nt=rt(g("os")),_e=G();function we(e,t,r){let n=new Q(e,t,r);process.stdout.write(n.toString()+nt.EOL)}b.issueCommand=we;function it(e,t=""){we(e,{},t)}b.issue=it;var ve="::",Q=class{constructor(t,r,n){t||(t="missing.command"),this.command=t,this.properties=r,this.message=n}toString(){let t=ve+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let r=!0;for(let n in this.properties)if(this.properties.hasOwnProperty(n)){let s=this.properties[n];s&&(r?r=!1:t+=",",t+=`${n}=${ot(s)}`)}}return t+=`${ve}${st(this.message)}`,t}};function st(e){return _e.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function ot(e){return _e.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}});var Re=O(E=>{"use strict";var at=E&&E.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),ut=E&&E.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),be=E&&E.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&at(t,e,r);return ut(t,e),t};Object.defineProperty(E,"__esModule",{value:!0});E.prepareKeyValueMessage=E.issueFileCommand=void 0;var Oe=be(g("fs")),X=be(g("os")),ct=(Qe(),ze(Ye)),Ee=G();function lt(e,t){let r=process.env[`GITHUB_${e}`];if(!r)throw new Error(`Unable to find environment variable for file command ${e}`);if(!Oe.existsSync(r))throw new Error(`Missing file at path: ${r}`);Oe.appendFileSync(r,`${Ee.toCommandValue(t)}${X.EOL}`,{encoding:"utf8"})}E.issueFileCommand=lt;function ft(e,t){let r=`ghadelimiter_${ct.v4()}`,n=Ee.toCommandValue(t);if(e.includes(r))throw new Error(`Unexpected input: name should not contain the delimiter "${r}"`);if(n.includes(r))throw new Error(`Unexpected input: value should not contain the delimiter "${r}"`);return`${e}<<${r}${X.EOL}${n}${X.EOL}${r}`}E.prepareKeyValueMessage=ft});var Pe=O($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.checkBypass=$.getProxyUrl=void 0;function dt(e){let t=e.protocol==="https:";if(Se(e))return;let r=(()=>t?process.env.https_proxy||process.env.HTTPS_PROXY:process.env.http_proxy||process.env.HTTP_PROXY)();if(r)return new URL(r)}$.getProxyUrl=dt;function Se(e){if(!e.hostname)return!1;let t=e.hostname;if(ht(t))return!0;let r=process.env.no_proxy||process.env.NO_PROXY||"";if(!r)return!1;let n;e.port?n=Number(e.port):e.protocol==="http:"?n=80:e.protocol==="https:"&&(n=443);let s=[e.hostname.toUpperCase()];typeof n=="number"&&s.push(`${s[0]}:${n}`);for(let i of r.split(",").map(o=>o.trim().toUpperCase()).filter(o=>o))if(i==="*"||s.some(o=>o===i||o.endsWith(`.${i}`)||i.startsWith(".")&&o.endsWith(`${i}`)))return!0;return!1}$.checkBypass=Se;function ht(e){let t=e.toLowerCase();return t==="localhost"||t.startsWith("127.")||t.startsWith("[::1]")||t.startsWith("[0:0:0:0:0:0:0:1]")}});var Me=O(N=>{"use strict";var Or=g("net"),pt=g("tls"),Z=g("http"),Te=g("https"),mt=g("events"),br=g("assert"),gt=g("util");N.httpOverHttp=vt;N.httpsOverHttp=_t;N.httpOverHttps=wt;N.httpsOverHttps=yt;function vt(e){var t=new T(e);return t.request=Z.request,t}function _t(e){var t=new T(e);return t.request=Z.request,t.createSocket=Ae,t.defaultPort=443,t}function wt(e){var t=new T(e);return t.request=Te.request,t}function yt(e){var t=new T(e);return t.request=Te.request,t.createSocket=Ae,t.defaultPort=443,t}function T(e){var t=this;t.options=e||{},t.proxyOptions=t.options.proxy||{},t.maxSockets=t.options.maxSockets||Z.Agent.defaultMaxSockets,t.requests=[],t.sockets=[],t.on("free",function(n,s,i,o){for(var l=qe(s,i,o),f=0,a=t.requests.length;f<a;++f){var u=t.requests[f];if(u.host===l.host&&u.port===l.port){t.requests.splice(f,1),u.request.onSocket(n);return}}n.destroy(),t.removeSocket(n)})}gt.inherits(T,mt.EventEmitter);T.prototype.addRequest=function(t,r,n,s){var i=this,o=ee({request:t},i.options,qe(r,n,s));if(i.sockets.length>=this.maxSockets){i.requests.push(o);return}i.createSocket(o,function(l){l.on("free",f),l.on("close",a),l.on("agentRemove",a),t.onSocket(l);function f(){i.emit("free",l,o)}function a(u){i.removeSocket(l),l.removeListener("free",f),l.removeListener("close",a),l.removeListener("agentRemove",a)}})};T.prototype.createSocket=function(t,r){var n=this,s={};n.sockets.push(s);var i=ee({},n.proxyOptions,{method:"CONNECT",path:t.host+":"+t.port,agent:!1,headers:{host:t.host+":"+t.port}});t.localAddress&&(i.localAddress=t.localAddress),i.proxyAuth&&(i.headers=i.headers||{},i.headers["Proxy-Authorization"]="Basic "+new Buffer(i.proxyAuth).toString("base64")),A("making CONNECT request");var o=n.request(i);o.useChunkedEncodingByDefault=!1,o.once("response",l),o.once("upgrade",f),o.once("connect",a),o.once("error",u),o.end();function l(d){d.upgrade=!0}function f(d,p,k){process.nextTick(function(){a(d,p,k)})}function a(d,p,k){if(o.removeAllListeners(),p.removeAllListeners(),d.statusCode!==200){A("tunneling socket could not be established, statusCode=%d",d.statusCode),p.destroy();var L=new Error("tunneling socket could not be established, statusCode="+d.statusCode);L.code="ECONNRESET",t.request.emit("error",L),n.removeSocket(s);return}if(k.length>0){A("got illegal response body from proxy"),p.destroy();var L=new Error("got illegal response body from proxy");L.code="ECONNRESET",t.request.emit("error",L),n.removeSocket(s);return}return A("tunneling connection has established"),n.sockets[n.sockets.indexOf(s)]=p,r(p)}function u(d){o.removeAllListeners(),A(`tunneling socket could not be established, cause=%s
`,d.message,d.stack);var p=new Error("tunneling socket could not be established, cause="+d.message);p.code="ECONNRESET",t.request.emit("error",p),n.removeSocket(s)}};T.prototype.removeSocket=function(t){var r=this.sockets.indexOf(t);if(r!==-1){this.sockets.splice(r,1);var n=this.requests.shift();n&&this.createSocket(n,function(s){n.request.onSocket(s)})}};function Ae(e,t){var r=this;T.prototype.createSocket.call(r,e,function(n){var s=e.request.getHeader("host"),i=ee({},r.options,{socket:n,servername:s?s.replace(/:.*$/,""):e.host}),o=pt.connect(0,i);r.sockets[r.sockets.indexOf(n)]=o,t(o)})}function qe(e,t,r){return typeof e=="string"?{host:e,port:t,localAddress:r}:e}function ee(e){for(var t=1,r=arguments.length;t<r;++t){var n=arguments[t];if(typeof n=="object")for(var s=Object.keys(n),i=0,o=s.length;i<o;++i){var l=s[i];n[l]!==void 0&&(e[l]=n[l])}}return e}var A;process.env.NODE_DEBUG&&/\btunnel\b/.test(process.env.NODE_DEBUG)?A=function(){var e=Array.prototype.slice.call(arguments);typeof e[0]=="string"?e[0]="TUNNEL: "+e[0]:e.unshift("TUNNEL:"),console.error.apply(console,e)}:A=function(){};N.debug=A});var ke=O((Rr,Ue)=>{Ue.exports=Me()});var $e=O(h=>{"use strict";var Ot=h&&h.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),bt=h&&h.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),z=h&&h.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Ot(t,e,r);return bt(t,e),t},m=h&&h.__awaiter||function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function l(u){try{a(n.next(u))}catch(d){o(d)}}function f(u){try{a(n.throw(u))}catch(d){o(d)}}function a(u){u.done?i(u.value):s(u.value).then(l,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(h,"__esModule",{value:!0});h.HttpClient=h.isHttps=h.HttpClientResponse=h.HttpClientError=h.getProxyUrl=h.MediaTypes=h.Headers=h.HttpCodes=void 0;var W=z(g("http")),te=z(g("https")),Ce=z(Pe()),J=z(ke()),S;(function(e){e[e.OK=200]="OK",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.ResourceMoved=302]="ResourceMoved",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.SwitchProxy=306]="SwitchProxy",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.TooManyRequests=429]="TooManyRequests",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout"})(S=h.HttpCodes||(h.HttpCodes={}));var _;(function(e){e.Accept="accept",e.ContentType="content-type"})(_=h.Headers||(h.Headers={}));var q;(function(e){e.ApplicationJson="application/json"})(q=h.MediaTypes||(h.MediaTypes={}));function Et(e){let t=Ce.getProxyUrl(new URL(e));return t?t.href:""}h.getProxyUrl=Et;var Rt=[S.MovedPermanently,S.ResourceMoved,S.SeeOther,S.TemporaryRedirect,S.PermanentRedirect],St=[S.BadGateway,S.ServiceUnavailable,S.GatewayTimeout],Pt=["OPTIONS","GET","DELETE","HEAD"],Tt=10,At=5,j=class extends Error{constructor(t,r){super(t),this.name="HttpClientError",this.statusCode=r,Object.setPrototypeOf(this,j.prototype)}};h.HttpClientError=j;var H=class{constructor(t){this.message=t}readBody(){return m(this,void 0,void 0,function*(){return new Promise(t=>m(this,void 0,void 0,function*(){let r=Buffer.alloc(0);this.message.on("data",n=>{r=Buffer.concat([r,n])}),this.message.on("end",()=>{t(r.toString())})}))})}};h.HttpClientResponse=H;function qt(e){return new URL(e).protocol==="https:"}h.isHttps=qt;var re=class{constructor(t,r,n){this._ignoreSslError=!1,this._allowRedirects=!0,this._allowRedirectDowngrade=!1,this._maxRedirects=50,this._allowRetries=!1,this._maxRetries=1,this._keepAlive=!1,this._disposed=!1,this.userAgent=t,this.handlers=r||[],this.requestOptions=n,n&&(n.ignoreSslError!=null&&(this._ignoreSslError=n.ignoreSslError),this._socketTimeout=n.socketTimeout,n.allowRedirects!=null&&(this._allowRedirects=n.allowRedirects),n.allowRedirectDowngrade!=null&&(this._allowRedirectDowngrade=n.allowRedirectDowngrade),n.maxRedirects!=null&&(this._maxRedirects=Math.max(n.maxRedirects,0)),n.keepAlive!=null&&(this._keepAlive=n.keepAlive),n.allowRetries!=null&&(this._allowRetries=n.allowRetries),n.maxRetries!=null&&(this._maxRetries=n.maxRetries))}options(t,r){return m(this,void 0,void 0,function*(){return this.request("OPTIONS",t,null,r||{})})}get(t,r){return m(this,void 0,void 0,function*(){return this.request("GET",t,null,r||{})})}del(t,r){return m(this,void 0,void 0,function*(){return this.request("DELETE",t,null,r||{})})}post(t,r,n){return m(this,void 0,void 0,function*(){return this.request("POST",t,r,n||{})})}patch(t,r,n){return m(this,void 0,void 0,function*(){return this.request("PATCH",t,r,n||{})})}put(t,r,n){return m(this,void 0,void 0,function*(){return this.request("PUT",t,r,n||{})})}head(t,r){return m(this,void 0,void 0,function*(){return this.request("HEAD",t,null,r||{})})}sendStream(t,r,n,s){return m(this,void 0,void 0,function*(){return this.request(t,r,n,s)})}getJson(t,r={}){return m(this,void 0,void 0,function*(){r[_.Accept]=this._getExistingOrDefaultHeader(r,_.Accept,q.ApplicationJson);let n=yield this.get(t,r);return this._processResponse(n,this.requestOptions)})}postJson(t,r,n={}){return m(this,void 0,void 0,function*(){let s=JSON.stringify(r,null,2);n[_.Accept]=this._getExistingOrDefaultHeader(n,_.Accept,q.ApplicationJson),n[_.ContentType]=this._getExistingOrDefaultHeader(n,_.ContentType,q.ApplicationJson);let i=yield this.post(t,s,n);return this._processResponse(i,this.requestOptions)})}putJson(t,r,n={}){return m(this,void 0,void 0,function*(){let s=JSON.stringify(r,null,2);n[_.Accept]=this._getExistingOrDefaultHeader(n,_.Accept,q.ApplicationJson),n[_.ContentType]=this._getExistingOrDefaultHeader(n,_.ContentType,q.ApplicationJson);let i=yield this.put(t,s,n);return this._processResponse(i,this.requestOptions)})}patchJson(t,r,n={}){return m(this,void 0,void 0,function*(){let s=JSON.stringify(r,null,2);n[_.Accept]=this._getExistingOrDefaultHeader(n,_.Accept,q.ApplicationJson),n[_.ContentType]=this._getExistingOrDefaultHeader(n,_.ContentType,q.ApplicationJson);let i=yield this.patch(t,s,n);return this._processResponse(i,this.requestOptions)})}request(t,r,n,s){return m(this,void 0,void 0,function*(){if(this._disposed)throw new Error("Client has already been disposed.");let i=new URL(r),o=this._prepareRequest(t,i,s),l=this._allowRetries&&Pt.includes(t)?this._maxRetries+1:1,f=0,a;do{if(a=yield this.requestRaw(o,n),a&&a.message&&a.message.statusCode===S.Unauthorized){let d;for(let p of this.handlers)if(p.canHandleAuthentication(a)){d=p;break}return d?d.handleAuthentication(this,o,n):a}let u=this._maxRedirects;for(;a.message.statusCode&&Rt.includes(a.message.statusCode)&&this._allowRedirects&&u>0;){let d=a.message.headers.location;if(!d)break;let p=new URL(d);if(i.protocol==="https:"&&i.protocol!==p.protocol&&!this._allowRedirectDowngrade)throw new Error("Redirect from HTTPS to HTTP protocol. This downgrade is not allowed for security reasons. If you want to allow this behavior, set the allowRedirectDowngrade option to true.");if(yield a.readBody(),p.hostname!==i.hostname)for(let k in s)k.toLowerCase()==="authorization"&&delete s[k];o=this._prepareRequest(t,p,s),a=yield this.requestRaw(o,n),u--}if(!a.message.statusCode||!St.includes(a.message.statusCode))return a;f+=1,f<l&&(yield a.readBody(),yield this._performExponentialBackoff(f))}while(f<l);return a})}dispose(){this._agent&&this._agent.destroy(),this._disposed=!0}requestRaw(t,r){return m(this,void 0,void 0,function*(){return new Promise((n,s)=>{function i(o,l){o?s(o):l?n(l):s(new Error("Unknown error"))}this.requestRawWithCallback(t,r,i)})})}requestRawWithCallback(t,r,n){typeof r=="string"&&(t.options.headers||(t.options.headers={}),t.options.headers["Content-Length"]=Buffer.byteLength(r,"utf8"));let s=!1;function i(f,a){s||(s=!0,n(f,a))}let o=t.httpModule.request(t.options,f=>{let a=new H(f);i(void 0,a)}),l;o.on("socket",f=>{l=f}),o.setTimeout(this._socketTimeout||3*6e4,()=>{l&&l.end(),i(new Error(`Request timeout: ${t.options.path}`))}),o.on("error",function(f){i(f)}),r&&typeof r=="string"&&o.write(r,"utf8"),r&&typeof r!="string"?(r.on("close",function(){o.end()}),r.pipe(o)):o.end()}getAgent(t){let r=new URL(t);return this._getAgent(r)}_prepareRequest(t,r,n){let s={};s.parsedUrl=r;let i=s.parsedUrl.protocol==="https:";s.httpModule=i?te:W;let o=i?443:80;if(s.options={},s.options.host=s.parsedUrl.hostname,s.options.port=s.parsedUrl.port?parseInt(s.parsedUrl.port):o,s.options.path=(s.parsedUrl.pathname||"")+(s.parsedUrl.search||""),s.options.method=t,s.options.headers=this._mergeHeaders(n),this.userAgent!=null&&(s.options.headers["user-agent"]=this.userAgent),s.options.agent=this._getAgent(s.parsedUrl),this.handlers)for(let l of this.handlers)l.prepareRequest(s.options);return s}_mergeHeaders(t){return this.requestOptions&&this.requestOptions.headers?Object.assign({},K(this.requestOptions.headers),K(t||{})):K(t||{})}_getExistingOrDefaultHeader(t,r,n){let s;return this.requestOptions&&this.requestOptions.headers&&(s=K(this.requestOptions.headers)[r]),t[r]||s||n}_getAgent(t){let r,n=Ce.getProxyUrl(t),s=n&&n.hostname;if(this._keepAlive&&s&&(r=this._proxyAgent),this._keepAlive&&!s&&(r=this._agent),r)return r;let i=t.protocol==="https:",o=100;if(this.requestOptions&&(o=this.requestOptions.maxSockets||W.globalAgent.maxSockets),n&&n.hostname){let l={maxSockets:o,keepAlive:this._keepAlive,proxy:Object.assign(Object.assign({},(n.username||n.password)&&{proxyAuth:`${n.username}:${n.password}`}),{host:n.hostname,port:n.port})},f,a=n.protocol==="https:";i?f=a?J.httpsOverHttps:J.httpsOverHttp:f=a?J.httpOverHttps:J.httpOverHttp,r=f(l),this._proxyAgent=r}if(this._keepAlive&&!r){let l={keepAlive:this._keepAlive,maxSockets:o};r=i?new te.Agent(l):new W.Agent(l),this._agent=r}return r||(r=i?te.globalAgent:W.globalAgent),i&&this._ignoreSslError&&(r.options=Object.assign(r.options||{},{rejectUnauthorized:!1})),r}_performExponentialBackoff(t){return m(this,void 0,void 0,function*(){t=Math.min(Tt,t);let r=At*Math.pow(2,t);return new Promise(n=>setTimeout(()=>n(),r))})}_processResponse(t,r){return m(this,void 0,void 0,function*(){return new Promise((n,s)=>m(this,void 0,void 0,function*(){let i=t.message.statusCode||0,o={statusCode:i,result:null,headers:{}};i===S.NotFound&&n(o);function l(u,d){if(typeof d=="string"){let p=new Date(d);if(!isNaN(p.valueOf()))return p}return d}let f,a;try{a=yield t.readBody(),a&&a.length>0&&(r&&r.deserializeDates?f=JSON.parse(a,l):f=JSON.parse(a),o.result=f),o.headers=t.message.headers}catch{}if(i>299){let u;f&&f.message?u=f.message:a&&a.length>0?u=a:u=`Failed request: (${i})`;let d=new j(u,i);d.result=o.result,s(d)}else n(o)}))})}};h.HttpClient=re;var K=e=>Object.keys(e).reduce((t,r)=>(t[r.toLowerCase()]=e[r],t),{})});var Ne=O(P=>{"use strict";var oe=P&&P.__awaiter||function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function l(u){try{a(n.next(u))}catch(d){o(d)}}function f(u){try{a(n.throw(u))}catch(d){o(d)}}function a(u){u.done?i(u.value):s(u.value).then(l,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(P,"__esModule",{value:!0});P.PersonalAccessTokenCredentialHandler=P.BearerCredentialHandler=P.BasicCredentialHandler=void 0;var ne=class{constructor(t,r){this.username=t,this.password=r}prepareRequest(t){if(!t.headers)throw Error("The request has no headers");t.headers.Authorization=`Basic ${Buffer.from(`${this.username}:${this.password}`).toString("base64")}`}canHandleAuthentication(){return!1}handleAuthentication(){return oe(this,void 0,void 0,function*(){throw new Error("not implemented")})}};P.BasicCredentialHandler=ne;var ie=class{constructor(t){this.token=t}prepareRequest(t){if(!t.headers)throw Error("The request has no headers");t.headers.Authorization=`Bearer ${this.token}`}canHandleAuthentication(){return!1}handleAuthentication(){return oe(this,void 0,void 0,function*(){throw new Error("not implemented")})}};P.BearerCredentialHandler=ie;var se=class{constructor(t){this.token=t}prepareRequest(t){if(!t.headers)throw Error("The request has no headers");t.headers.Authorization=`Basic ${Buffer.from(`PAT:${this.token}`).toString("base64")}`}canHandleAuthentication(){return!1}handleAuthentication(){return oe(this,void 0,void 0,function*(){throw new Error("not implemented")})}};P.PersonalAccessTokenCredentialHandler=se});var De=O(B=>{"use strict";var je=B&&B.__awaiter||function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function l(u){try{a(n.next(u))}catch(d){o(d)}}function f(u){try{a(n.throw(u))}catch(d){o(d)}}function a(u){u.done?i(u.value):s(u.value).then(l,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(B,"__esModule",{value:!0});B.OidcClient=void 0;var Mt=$e(),Ut=Ne(),Be=Y(),M=class{static createHttpClient(t=!0,r=10){let n={allowRetries:t,maxRetries:r};return new Mt.HttpClient("actions/oidc-client",[new Ut.BearerCredentialHandler(M.getRequestToken())],n)}static getRequestToken(){let t=process.env.ACTIONS_ID_TOKEN_REQUEST_TOKEN;if(!t)throw new Error("Unable to get ACTIONS_ID_TOKEN_REQUEST_TOKEN env variable");return t}static getIDTokenUrl(){let t=process.env.ACTIONS_ID_TOKEN_REQUEST_URL;if(!t)throw new Error("Unable to get ACTIONS_ID_TOKEN_REQUEST_URL env variable");return t}static getCall(t){var r;return je(this,void 0,void 0,function*(){let i=(r=(yield M.createHttpClient().getJson(t).catch(o=>{throw new Error(`Failed to get ID Token. 
 
        Error Code : ${o.statusCode}
 
        Error Message: ${o.result.message}`)})).result)===null||r===void 0?void 0:r.value;if(!i)throw new Error("Response json body do not have ID Token field");return i})}static getIDToken(t){return je(this,void 0,void 0,function*(){try{let r=M.getIDTokenUrl();if(t){let s=encodeURIComponent(t);r=`${r}&audience=${s}`}Be.debug(`ID token url is ${r}`);let n=yield M.getCall(r);return Be.setSecret(n),n}catch(r){throw new Error(`Error message: ${r.message}`)}})}};B.OidcClient=M});var le=O(w=>{"use strict";var ae=w&&w.__awaiter||function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function l(u){try{a(n.next(u))}catch(d){o(d)}}function f(u){try{a(n.throw(u))}catch(d){o(d)}}function a(u){u.done?i(u.value):s(u.value).then(l,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(w,"__esModule",{value:!0});w.summary=w.markdownSummary=w.SUMMARY_DOCS_URL=w.SUMMARY_ENV_VAR=void 0;var kt=g("os"),ue=g("fs"),{access:Ct,appendFile:$t,writeFile:Nt}=ue.promises;w.SUMMARY_ENV_VAR="GITHUB_STEP_SUMMARY";w.SUMMARY_DOCS_URL="https://docs.github.com/actions/using-workflows/workflow-commands-for-github-actions#adding-a-job-summary";var ce=class{constructor(){this._buffer=""}filePath(){return ae(this,void 0,void 0,function*(){if(this._filePath)return this._filePath;let t=process.env[w.SUMMARY_ENV_VAR];if(!t)throw new Error(`Unable to find environment variable for $${w.SUMMARY_ENV_VAR}. Check if your runtime environment supports job summaries.`);try{yield Ct(t,ue.constants.R_OK|ue.constants.W_OK)}catch{throw new Error(`Unable to access summary file: '${t}'. Check if the file has correct read/write permissions.`)}return this._filePath=t,this._filePath})}wrap(t,r,n={}){let s=Object.entries(n).map(([i,o])=>` ${i}="${o}"`).join("");return r?`<${t}${s}>${r}</${t}>`:`<${t}${s}>`}write(t){return ae(this,void 0,void 0,function*(){let r=!!(t!=null&&t.overwrite),n=yield this.filePath();return yield(r?Nt:$t)(n,this._buffer,{encoding:"utf8"}),this.emptyBuffer()})}clear(){return ae(this,void 0,void 0,function*(){return this.emptyBuffer().write({overwrite:!0})})}stringify(){return this._buffer}isEmptyBuffer(){return this._buffer.length===0}emptyBuffer(){return this._buffer="",this}addRaw(t,r=!1){return this._buffer+=t,r?this.addEOL():this}addEOL(){return this.addRaw(kt.EOL)}addCodeBlock(t,r){let n=Object.assign({},r&&{lang:r}),s=this.wrap("pre",this.wrap("code",t),n);return this.addRaw(s).addEOL()}addList(t,r=!1){let n=r?"ol":"ul",s=t.map(o=>this.wrap("li",o)).join(""),i=this.wrap(n,s);return this.addRaw(i).addEOL()}addTable(t){let r=t.map(s=>{let i=s.map(o=>{if(typeof o=="string")return this.wrap("td",o);let{header:l,data:f,colspan:a,rowspan:u}=o,d=l?"th":"td",p=Object.assign(Object.assign({},a&&{colspan:a}),u&&{rowspan:u});return this.wrap(d,f,p)}).join("");return this.wrap("tr",i)}).join(""),n=this.wrap("table",r);return this.addRaw(n).addEOL()}addDetails(t,r){let n=this.wrap("details",this.wrap("summary",t)+r);return this.addRaw(n).addEOL()}addImage(t,r,n){let{width:s,height:i}=n||{},o=Object.assign(Object.assign({},s&&{width:s}),i&&{height:i}),l=this.wrap("img",null,Object.assign({src:t,alt:r},o));return this.addRaw(l).addEOL()}addHeading(t,r){let n=`h${r}`,s=["h1","h2","h3","h4","h5","h6"].includes(n)?n:"h1",i=this.wrap(s,t);return this.addRaw(i).addEOL()}addSeparator(){let t=this.wrap("hr",null);return this.addRaw(t).addEOL()}addBreak(){let t=this.wrap("br",null);return this.addRaw(t).addEOL()}addQuote(t,r){let n=Object.assign({},r&&{cite:r}),s=this.wrap("blockquote",t,n);return this.addRaw(s).addEOL()}addLink(t,r){let n=this.wrap("a",t,{href:r});return this.addRaw(n).addEOL()}},xe=new ce;w.markdownSummary=xe;w.summary=xe});var Le=O(y=>{"use strict";var jt=y&&y.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Bt=y&&y.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Dt=y&&y.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&jt(t,e,r);return Bt(t,e),t};Object.defineProperty(y,"__esModule",{value:!0});y.toPlatformPath=y.toWin32Path=y.toPosixPath=void 0;var xt=Dt(g("path"));function Lt(e){return e.replace(/[\\]/g,"/")}y.toPosixPath=Lt;function It(e){return e.replace(/[/]/g,"\\")}y.toWin32Path=It;function Ft(e){return e.replace(/[/\\]/g,xt.sep)}y.toPlatformPath=Ft});var Y=O(c=>{"use strict";var Vt=c&&c.__createBinding||(Object.create?function(e,t,r,n){n===void 0&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){n===void 0&&(n=r),e[n]=t[r]}),Gt=c&&c.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ie=c&&c.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)r!=="default"&&Object.hasOwnProperty.call(e,r)&&Vt(t,e,r);return Gt(t,e),t},Fe=c&&c.__awaiter||function(e,t,r,n){function s(i){return i instanceof r?i:new r(function(o){o(i)})}return new(r||(r=Promise))(function(i,o){function l(u){try{a(n.next(u))}catch(d){o(d)}}function f(u){try{a(n.throw(u))}catch(d){o(d)}}function a(u){u.done?i(u.value):s(u.value).then(l,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(c,"__esModule",{value:!0});c.getIDToken=c.getState=c.saveState=c.group=c.endGroup=c.startGroup=c.info=c.notice=c.warning=c.error=c.debug=c.isDebug=c.setFailed=c.setCommandEcho=c.setOutput=c.getBooleanInput=c.getMultilineInput=c.getInput=c.addPath=c.setSecret=c.exportVariable=c.ExitCode=void 0;var R=ye(),U=Re(),D=G(),Ve=Ie(g("os")),Wt=Ie(g("path")),Jt=De(),Ge;(function(e){e[e.Success=0]="Success",e[e.Failure=1]="Failure"})(Ge=c.ExitCode||(c.ExitCode={}));function Kt(e,t){let r=D.toCommandValue(t);if(process.env[e]=r,process.env.GITHUB_ENV||"")return U.issueFileCommand("ENV",U.prepareKeyValueMessage(e,t));R.issueCommand("set-env",{name:e},r)}c.exportVariable=Kt;function Ht(e){R.issueCommand("add-mask",{},e)}c.setSecret=Ht;function zt(e){process.env.GITHUB_PATH||""?U.issueFileCommand("PATH",e):R.issueCommand("add-path",{},e),process.env.PATH=`${e}${Wt.delimiter}${process.env.PATH}`}c.addPath=zt;function fe(e,t){let r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r)throw new Error(`Input required and not supplied: ${e}`);return t&&t.trimWhitespace===!1?r:r.trim()}c.getInput=fe;function Yt(e,t){let r=fe(e,t).split(`
`).filter(n=>n!=="");return t&&t.trimWhitespace===!1?r:r.map(n=>n.trim())}c.getMultilineInput=Yt;function Qt(e,t){let r=["true","True","TRUE"],n=["false","False","FALSE"],s=fe(e,t);if(r.includes(s))return!0;if(n.includes(s))return!1;throw new TypeError(`Input does not meet YAML 1.2 "Core Schema" specification: ${e}
Support boolean input list: \`true | True | TRUE | false | False | FALSE\``)}c.getBooleanInput=Qt;function Xt(e,t){if(process.env.GITHUB_OUTPUT||"")return U.issueFileCommand("OUTPUT",U.prepareKeyValueMessage(e,t));process.stdout.write(Ve.EOL),R.issueCommand("set-output",{name:e},D.toCommandValue(t))}c.setOutput=Xt;function Zt(e){R.issue("echo",e?"on":"off")}c.setCommandEcho=Zt;function er(e){process.exitCode=Ge.Failure,We(e)}c.setFailed=er;function tr(){return process.env.RUNNER_DEBUG==="1"}c.isDebug=tr;function rr(e){R.issueCommand("debug",{},e)}c.debug=rr;function We(e,t={}){R.issueCommand("error",D.toCommandProperties(t),e instanceof Error?e.toString():e)}c.error=We;function nr(e,t={}){R.issueCommand("warning",D.toCommandProperties(t),e instanceof Error?e.toString():e)}c.warning=nr;function ir(e,t={}){R.issueCommand("notice",D.toCommandProperties(t),e instanceof Error?e.toString():e)}c.notice=ir;function sr(e){process.stdout.write(e+Ve.EOL)}c.info=sr;function Je(e){R.issue("group",e)}c.startGroup=Je;function Ke(){R.issue("endgroup")}c.endGroup=Ke;function or(e,t){return Fe(this,void 0,void 0,function*(){Je(e);let r;try{r=yield t()}finally{Ke()}return r})}c.group=or;function ar(e,t){if(process.env.GITHUB_STATE||"")return U.issueFileCommand("STATE",U.prepareKeyValueMessage(e,t));R.issueCommand("save-state",{name:e},D.toCommandValue(t))}c.saveState=ar;function ur(e){return process.env[`STATE_${e}`]||""}c.getState=ur;function cr(e){return Fe(this,void 0,void 0,function*(){return yield Jt.OidcClient.getIDToken(e)})}c.getIDToken=cr;var lr=le();Object.defineProperty(c,"summary",{enumerable:!0,get:function(){return lr.summary}});var fr=le();Object.defineProperty(c,"markdownSummary",{enumerable:!0,get:function(){return fr.markdownSummary}});var de=Le();Object.defineProperty(c,"toPosixPath",{enumerable:!0,get:function(){return de.toPosixPath}});Object.defineProperty(c,"toWin32Path",{enumerable:!0,get:function(){return de.toWin32Path}});Object.defineProperty(c,"toPlatformPath",{enumerable:!0,get:function(){return de.toPlatformPath}})});var x=he(Y());var v=he(Y());function I(e){let t=F(),r=`${t.config.stage}-${t.config.name}-`;return e.startsWith(r)?e.substring(r.length):e}var He=async e=>{let t=F(),[r,n]=await V.load(t.paths.config),s=await V.synth({fn:n.stacks,mode:"deploy"});v.summary.addHeading(`Summary diff against ${e}`);let i=0,o=0;for(let l of s.stacks){let f=await mr(l.stackName,t.config.region);if(!f){v.summary.addHeading(`${I(l.stackName)}: New stack`,2),v.summary.addSeparator();continue}let{count:a,diff:u}=await V.diff(l,f);a===0?v.summary.addHeading(`${I(l.stackName)}: No changes`,2):a===1?(v.summary.addHeading(`${I(l.stackName)}: ${a} change`,2),v.summary.addCodeBlock(u,"diff"),i+=a,o++):(v.summary.addHeading(`${I(l.stackName)}: ${a} changes`,2),v.summary.addCodeBlock(u,"diff"),i+=a,o++),v.summary.addBreak(),v.summary.addSeparator(),v.summary.addBreak()}o===0?v.summary.addRaw("No changes"):v.summary.addRaw(`${i===1?"1 change found in":`${i} changes in`} ${o===1?"1 stack":`${o} stacks`}`),await v.summary.write()};function dr(e){return typeof e=="object"&&e!==null&&"message"in e&&typeof e.message=="string"}function hr(e){if(dr(e))return e;try{return new Error(JSON.stringify(e))}catch{return new Error(String(e))}}function pr(e){return hr(e).message}async function mr(e,t){try{let n=await new me({region:t}).send(new ge({StackName:e}));return JSON.parse(n.TemplateBody||"")}catch(r){(0,v.setFailed)(pr(r))}}async function gr(){try{let e=(0,x.getInput)("stage");(0,x.debug)(`Running diff against stage ${e}`),await pe({stage:e}),await He(e)}catch(e){e instanceof Error&&(0,x.setFailed)(e.message)}}gr();
